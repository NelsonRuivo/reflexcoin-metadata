<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ReflexCoin 2.0 — RFX2</title>
  <style>
    :root{--bg:#071021;--panel:#0d1520;--accent:#8a2dff;--gold:#d4ab5b;--muted:#9aa6b2;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--bg),#02030b);color:#e6eef8}
    .app{display:flex;height:100vh;overflow:hidden}

    /* Sidebar */
    .sidebar{width:240px;background:linear-gradient(180deg,#071018,#071220);padding:20px;display:flex;flex-direction:column;gap:12px;border-right:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:4px}
    .brand img{width:72px;height:72px;object-fit:contain;border-radius:8px}
    .brand h1{font-size:16px;margin:0;color:var(--gold)}
    .nav a{display:block;padding:10px 12px;border-radius:10px;color:var(--muted);text-decoration:none;font-weight:600;margin-bottom:6px;background:transparent}
    .nav a:hover{background:var(--glass);color:#fff}

    /* Main */
    .main{flex:1;display:flex;flex-direction:column;padding:20px;height:100vh;overflow:hidden}
    .top{display:flex;align-items:center;gap:18px}
    .logo-large{display:flex;align-items:center;gap:14px}
    .logo-large img{width:140px;height:140px}
    .logo-large h2{margin:0;font-size:28px;color:var(--gold)}

    .row{display:flex;gap:18px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;box-shadow:0 6px 24px rgba(10,10,12,0.6);border:1px solid rgba(255,255,255,0.03)}
    .card.small{width:220px}
    .card.flex{flex:1}

    .emotions{display:flex;gap:10px;flex-wrap:wrap}
    .emotions button{background:#0b1220;border:1px solid rgba(255,255,255,0.04);padding:10px 14px;border-radius:10px;color:#fff;font-weight:700;cursor:pointer}
    .emotions button:hover{transform:translateY(-3px);transition:0.18s}

    .actions{display:flex;gap:12px;align-items:center}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:10px;text-decoration:none;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    .small-muted{font-size:12px;color:var(--muted)}

    /* price box */
    .price-box{display:flex;flex-direction:column;align-items:flex-start;gap:6px}
    .price-value{font-size:28px;font-weight:800}
    .price-change{font-size:12px;color:var(--muted)}

    /* sparkline */
    .sparkline{width:220px;height:60px}

    .footer{margin-top:auto;padding-top:12px;color:var(--muted);font-size:13px}

    @media (min-width:1000px){.sidebar{height:100vh}.main{height:100vh}}
    @media(max-width:900px){.app{flex-direction:column}.sidebar{width:100%;flex-direction:row;overflow:auto}.logo-large img{width:84px;height:84px}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="brand">
        <img id="sidebarLogo" src="logo-rfx2.png" alt="logo" />
        <div>
          <h1>ReflexCoin 2.0</h1>
          <div style="color:var(--muted);font-size:12px">RFX2 • Solana</div>
        </div>
      </div>

      <nav class="nav">
        <a id="connectBtn" href="#">Connect Phantom</a>
        <a id="addPhantomBtn" href="#">Add RFX2 to Phantom</a>
        <a id="buyBtn" href="#">Buy on Raydium</a>
        <a href="https://t.me/ReflexCoinCommunity" target="_blank">Telegram</a>
        <a id="twitterLink" href="https://x.com/ReflexcoinRfx" target="_blank">X / Twitter</a>
        <a href="https://github.com/ReflexCoin2-0-Project/reflexcoin-metadata" target="_blank">GitHub</a>
      </nav>

      <div style="margin-top:12px">
        <div class="small-muted" style="margin-bottom:6px">Quick actions</div>
        <a class="nav" href="#">Express Emotion</a>
        <a class="nav" href="#">Claim Airdrop (soon)</a>
      </div>

    </aside>

    <main class="main">
      <div class="top">
        <div class="logo-large">
          <img id="mainLogo" src="logo-rfx2.png" alt="logo" />
          <div>
            <h2>ReflexCoin 2.0 — RFX2</h2>
            <div style="color:var(--muted);margin-top:6px">A token that represents collective emotional value on Solana</div>
          </div>
        </div>

        <div style="margin-left:auto;display:flex;flex-direction:column;gap:8px">
          <div class="card small" id="supplyCard">
            <div class="small-muted">Total Supply</div>
            <div style="font-size:18px;font-weight:800">2,000,000</div>
          </div>
          <div class="card small" id="holdersCard">
            <div class="small-muted">Holders</div>
            <div style="font-size:18px;font-weight:800"><span id="holdersCount">—</span></div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:22px;align-items:flex-start">
        <div class="card flex" style="min-width:520px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small-muted">Market</div>
              <div style="font-size:20px;font-weight:800">ReflexCoin Live</div>
            </div>

            <div style="display:flex;gap:12px;align-items:center">
              <div class="price-box">
                <div class="small-muted">Price (SOL)</div>
                <div class="price-value" id="priceSOL">—</div>
                <div class="price-change" id="priceChange">—</div>
              </div>

              <div class="price-box" style="margin-left:14px">
                <div class="small-muted">Price (USD)</div>
                <div class="price-value" id="priceUSD">—</div>
                <div class="price-change" id="priceMarket">—</div>
              </div>

              <canvas id="spark" class="sparkline"></canvas>
            </div>
          </div>

          <div style="margin-top:16px">
            <div style="display:flex;gap:10px;align-items:center">
              <a id="openPhantom" class="btn" href="#">Open in Phantom</a>
              <a id="raydiumSwap" class="btn" target="_blank" href="#">Buy on Raydium</a>
              <a id="addToPhantom" class="btn ghost" href="#">Add token to Phantom</a>
            </div>

            <div style="margin-top:14px;color:var(--muted);font-size:13px">To be eligible for future airdrops users will need to hold a minimum amount of RFX2 and have recorded daily emotions. This is a simulated flow.</div>
          </div>
        </div>

        <div style="width:320px;display:flex;flex-direction:column;gap:12px">
          <div class="card">
            <div class="small-muted">Connect Wallet</div>
            <div style="margin-top:10px"><button id="connectWallet" class="btn">Connect Phantom Wallet</button></div>
            <div style="margin-top:8px;color:var(--muted);font-size:13px">Connected: <span id="pk">Not connected</span></div>
          </div>

          <div class="card">
            <div class="small-muted">Emotion Stats (today)</div>
            <div style="margin-top:10px;font-weight:700" id="stats">Happy:0 • Angry:0 • Sad:0 • Motivated:0 • Loved:0</div>
          </div>

          <div class="card">
            <div class="small-muted">Quick Links</div>
            <div style="margin-top:8px"><a id="addPhantomQuick" href="#" style="color:var(--accent)">Add token to Phantom</a></div>
            <div style="margin-top:6px"><a id="solExplorer" href="#" target="_blank" style="color:var(--muted)">View on Solana Explorer</a></div>
          </div>
        </div>
      </div>

      <div class="footer">ReflexCoin 2.0 — © 2025. Contract: <code id="mintAddress">43qV5jUhNEtsPeoLzEZyRLYA5tUSNTo2rgVv8mCJsx9z</code></div>
    </main>
  </div>

  <script>
    // Config
    const MINT = '43qV5jUhNEtsPeoLzEZyRLYA5tUSNTo2rgVv8mCJsx9z';
    const RAYDIUM_SWAP = 'https://raydium.io/swap/?inputMint=sol&outputMint=' + MINT;
    const PHANTOM_UL = 'https://phantom.app/ul/browse/' + MINT;
    const DEXSCREENER_API = 'https://api.dexscreener.com/latest/dex/tokens/solana/' + MINT;
    const SOLSCAN_TOKEN_URL = 'https://solscan.io/token/' + MINT + '?cluster=mainnet';

    // Elements
    const priceSOLEl = document.getElementById('priceSOL');
    const priceUSDEl = document.getElementById('priceUSD');
    const priceChangeEl = document.getElementById('priceChange');
    const priceMarketEl = document.getElementById('priceMarket');
    const spark = document.getElementById('spark');
    const holdersCountEl = document.getElementById('holdersCount');

    // Set links
    document.getElementById('raydiumSwap').href = RAYDIUM_SWAP;
    document.getElementById('buyBtn').href = RAYDIUM_SWAP;
    document.getElementById('addPhantomBtn').href = PHANTOM_UL;
    document.getElementById('addToPhantom').href = PHANTOM_UL;
    document.getElementById('addPhantomQuick').href = PHANTOM_UL;
    document.getElementById('solExplorer').href = SOLSCAN_TOKEN_URL;
    document.getElementById('openPhantom').href = PHANTOM_UL;

    // Small helper: format
    function fmtUsd(v){return v?('$'+Number(v).toLocaleString(undefined,{maximumFractionDigits:6})): '—'}
    function fmtSol(v){return v?Number(v).toFixed(8):'—'}

    // Try to fetch price & chart from Dexscreener
    async function fetchMarket(){
      try{
        const res = await fetch(DEXSCREENER_API);
        if(!res.ok) throw new Error('no dex');
        const data = await res.json();
        // data.pairs usually contains the first pair info
        const pair = (data && data.pairs && data.pairs[0]) || null;
        let priceUsd = null, priceSol = null, change = null, chart = null;
        if(pair){
          if(pair.priceUsd) priceUsd = pair.priceUsd;
          if(pair.price) priceSol = pair.price; // price relative to base token on pair
          // Dexscreener returns priceChange? try multiple fields
          change = pair.priceChange || pair.pairPriceChange || null;
        }
        // fallback: try data.token and data.chart
        if(!priceUsd && data.token && data.token.priceUsd) priceUsd = data.token.priceUsd;
        if(data.chart && Array.isArray(data.chart)) chart = data.chart.map(p=>p.close);

        // Update UI
        if(priceSol) priceSOLEl.textContent = fmtSol(priceSol) + ' SOL'; else priceSOLEl.textContent = '—';
        if(priceUsd) priceUSDEl.textContent = fmtUsd(priceUsd); else priceUSDEl.textContent = '—';
        if(change) priceChangeEl.textContent = (change>0?'+':'')+ (Number(change).toFixed(2)) + '%'; else priceChangeEl.textContent = '—';

        // draw sparkline
        const points = chart && chart.length?chart.slice(-40): (priceUsd? new Array(20).fill(priceUsd): null);
        drawSpark(points);

      }catch(err){
        console.error('market error',err);
        priceSOLEl.textContent = 'N/A';
        priceUSDEl.textContent = 'N/A';
        priceChangeEl.textContent = '—';
        drawSpark(null);
      }
    }

    // Simple sparkline (canvas)
    function drawSpark(points){
      const c = spark; const ctx = c.getContext('2d');
      const w = c.width = c.clientWidth; const h = c.height = c.clientHeight; ctx.clearRect(0,0,w,h);
      ctx.lineWidth = 2; ctx.strokeStyle = '#8a2dff'; ctx.fillStyle = 'rgba(138,45,255,0.06)';
      if(!points || points.length<2){
        // placeholder
        ctx.strokeStyle = '#444'; ctx.beginPath(); ctx.moveTo(0,h/2); ctx.lineTo(w,h/2); ctx.stroke(); return;
      }
      const min = Math.min(...points); const max = Math.max(...points); const range = max-min || 1;
      const step = w/(points.length-1);
      ctx.beginPath();
      points.forEach((p,i)=>{
        const x = i*step; const y = h - ((p-min)/range)*h; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      });
      ctx.stroke();
    }

    // Try to get holders count via Solscan public API (best-effort). If fails, show link to Solscan.
    async function fetchHolders(){
      try{
        // public solscan endpoint - may be rate-limited. Try and degrade gracefully.
        const url = 'https://public-api.solscan.io/token/holders?tokenAddress=' + MINT + '&offset=0&size=1';
        const res = await fetch(url);
        if(!res.ok) throw new Error('no solscan');
        const json = await res.json();
        // Some responses include total or pagination; attempt to read length or total
        if(json.total){ holdersCountEl.textContent = json.total; return; }
        if(Array.isArray(json.data) && json.data.length>=0){
          // solscan returns pages - there's no total field sometimes; guess by header? fallback
          holdersCountEl.textContent = json.total || json.length || 'see Solscan';
          return;
        }
        holdersCountEl.textContent = '—';
      }catch(e){
        console.warn('holders error',e);
        holdersCountEl.innerHTML = `<a href='${SOLSCAN_TOKEN_URL}' target='_blank' style='color:var(--accent)'>View on Solscan</a>`;
      }
    }

    // Wallet connect (Phantom)
    async function connectPhantom(){
      if(window.solana && window.solana.isPhantom){
        try{ const resp = await window.solana.connect(); document.getElementById('pk').textContent = resp.publicKey.toString(); localStorage.setItem('rfx_pk', resp.publicKey.toString()); }catch(e){console.error(e);alert('Connection rejected')}
      }else{ alert('Phantom not installed. Open the site in a browser with Phantom or install the extension.'); }
    }

    document.getElementById('connectWallet').addEventListener('click',connectPhantom);

    // initial load and polling
    fetchMarket(); fetchHolders();
    setInterval(fetchMarket, 30_000); // refresh every 30s
    setInterval(fetchHolders, 180_000); // refresh every 3min

  </script>
</body>
</html>
